// User Registration Techniques
Flow org.gluu.agama.registration.main
     Basepath ""
     Timeout 360 seconds
     Configs conf
// Declare a variable for UI feedback messages.
uiFeedback = {}
userInput = {}
// Iterate x times max
Repeat 6 times max
     // Retrieve user profile from UI
     userInput = RRF "profile.ftlh" uiFeedback
     // Getting all data from user
     userName = userInput.uid
     email = userInput.mail
     phone = userInput.jansMobile
     country = userInput.country
     referral = userInput.referralCode
     // Log collected input from profile.ftlh
     Log "@info Username entered: " userInput.uid userInput.mail userInput.jansMobile userInput.country userInput.referralCode
     // Initialize the JansUserRegistration service with configuration
     regService = Call org.gluu.agama.registration.JansUserRegistration#getInstance 
     // Checks if the entered username meets policy rules
     isUsernamePolicyMatch = Call regService usernamePolicyMatch userName
     // if username policy match
     When isUsernamePolicyMatch is true
          // Try collecting the OTP code from the UI for maximum x(3) times.
          y = Repeat 3 times max
               // Show UI to collect OTP code from user.
               smsInput = RRF "verifysms.ftlh" uiFeedback
               // Add log entry with collected code in log file.
               Log "@info Information provided by the user is : " smsInput
               When smsInput.hasRequestedNewCode is not "yes"
                    // Validate the OTP code provided by the user.
                    otpValidationResult = Call regService validateSmsOtp phone smsInput.code
                    // Add log entry withvalidation result in log file.
                    Log "@info OTP validation result is:" otpValidationResult
                    When 
                         Call __________#__________ 
                    Log "@ " __________
               // Log new code request
               Log "@info User has requested a new code."
               // Resend OTP code to user
               resendHasSucceed = Call regService sendSmsOtp phone
               When 
                    Log "@ " __________
               Log "@info New OTP code send successfully!" resendHasSucceed
               // Provide feedback about the error message to user.
               uiFeedback.infoMessage = "A new OTP code has been send to you on your mobile phone."
          //  Maximum attempts reached. OTP validation failed!
          Log "@error Maximum attempts reached. OTP validation failed!"
          // OTP validation has failed.
          Finish otpValidationResult
     Otherwise
          // Name should contain only alphabets
          uiFeedback.errorMessage = "Name should contain only alphabets"
// Maximum attempt reached
Log "@info Maximum attempt reached"
// User Registration flow failed
it_dymje = {success:false, error: "User registration flow reached max attempts try later"}
Finish it_dymje